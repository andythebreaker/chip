<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.11/semantic.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.11/semantic.js"></script>

<div class="ui container">
    <h2>向量長度；矩陣(另一邊)寬；(100；400)</h2>
    <div class="ui checkbox">
        <input type="checkbox" name="example">
        <label>勾就是tanh沒勾就是sigmoid</label>
    </div>
    <div class="ui input">
        <input type="number" id="numUpDown" value="100">
        <input type="number" id="numUpDown2" value="400">
        <div class="ui basic segment">
            <button style="display:none;" class="ui button" id="numUp">Up</button>
            <button style="display:none;" class="ui button" id="numDown">Down</button>
            <button class="ui button" id="gen">gen</button>
        </div>
    </div>
    <br>
    <div class="ui input">
        <textarea id="textBox" rows="48"></textarea>
    </div>
    <div class="ui button" id="downloadButton">Download</div>
</div>

<script>
    var stsw;
    $(document).ready(function () {
        stsw = $('.ui.checkbox').checkbox({
            onChange: function () {
                var isChecked = $(this).is(':checked');
                console.log('Toggle Switch state changed: ' + isChecked);
            }
        });

        // Get the number input
        var numUpDown = $("#numUpDown");
        var numUpDown2 = $("#numUpDown2");

        // Get the text input
        var textBox = $("#textBox");

        // Get the download button
        var downloadButton = $("#downloadButton");

        // When the up button is clicked, increase the number
        $("#numUp").on("click", function () {
            numUpDown.val(Number(numUpDown.val()) + 1);
        });

        // When the down button is clicked, decrease the number
        $("#numDown").on("click", function () {
            numUpDown.val(Number(numUpDown.val()) - 1);
        });

        $("#gen").on("click", function () {
            var tmp = Number(numUpDown.val());
            // add text "this is a text" to element textBox.val()
            var sector1 = `//this is generated by tool/gen_non_linear/index.html
\`define size_minus_1(x) (x-1)
\`define matrix_size_1 ${Number(numUpDown.val())}
\`define matrix_size_2 ${Number(numUpDown2.val())}
\`define vector_size \`matrix_size_1

${stsw[0].classList.contains('checked')  ? '\`include "../tanh_module_workspace/tanh.sv"' : '\`include "../sigmoid_module_workspace/sigmoid.sv"'}
module long_non_linear_shape_${Number(numUpDown.val())}_${Number(numUpDown2.val())}_${stsw[0].classList.contains('checked')  ? "tanh" : "sigmoid"} (
    input logic signed [31:0] x[0:\`size_minus_1(\`vector_size)],    
    output logic signed [31:0] y[0:\`size_minus_1(\`vector_size)]
`;
            var sector2 = '';
            for (let index = 0; index < Number(numUpDown.val()); index++) {
                sector2 += `${stsw[0].classList.contains('checked')  ? "tanh" : "sigmoid"} dux${index}(x[${index}], y[${index}]);
    `;
            }

            var sector3 = `
endmodule
`;
            textBox.val(sector1 + ');' + sector2 + sector3);
        });

        // When the download button is clicked, download the text from the text input
        $("#downloadButton").on("click", function () {
            var text = textBox.val();
            var link = document.createElement("a");
            link.href = "data:text/plain;charset=utf-8," + encodeURIComponent(text);
            link.download = `long_non_linear_shape_${Number(numUpDown.val())}_${Number(numUpDown2.val())}_${stsw[0].classList.contains('checked')  ? "tanh" : "sigmoid"}.sv`;
            document.body.appendChild(link);
            link.click();
        });
    });
</script>